

{%extends 'main.html'%}

{%block content%}


<style>
    .question-container{
        display: grid;
        grid-template-columns: 3fr 1fr;

    }
</style>


<div class="question-container">
   <div>
    <h5>@{{question.host}}</h5>
    <h1>{{question.write_question}}</h1>
    <h5>Topic: {{question.topic}}</h5>


   <div class="comment-wrapper">
      <h3>Conversation</h3>
      <hr>
      {%for message in question_messages%}
      <div>
        {% if request.user == message.user%}
        
        <a href="{%url 'delete-message' message.id %}">Delete</a>
        {%endif%}
        <small>@{{message.user}} {{message.created|timesince}} ago</small>
        <h4>{{message.comment}} </h4>

        <button onclick="showReplyForm({{message.id}})">Reply</button>
        
        <div id="reply-form-{{ message.id }}" class="reply-Sform" style="display: none;">
            <form method="POST">
                {% csrf_token %}
                <textarea name="comment" placeholder="Write your answer">@{{message.user}} </textarea>
                <input type="hidden" name="parent_id" value="{{ message.id }}">
                <button type="submit">Submit</button>
            </form>
        </div>
    
        {% if message.replies.count > 0 %}
        <ul>
            {% for reply in message.replies.all %}
            <li>

                <strong>{{ reply.user.username }}</strong>  
                <small>{{reply.created|timesince}} ago</small>
               

                {%if request.user == reply.user%} 
                <a href="{%url 'delete-reply' reply.id %}">Delete</a>
                {%endif%}



                
                <p>{{ reply.comment }}</p> 
                <hr>
            </li>
            {% endfor %}
        </ul>
        {% endif %}
      </div>
    
      <hr>
      {%endfor%}
    </div>

    {%if request.user.is_authenticated%}  
    <div class="comment-form">
        <form method="POST" action="">
           {%csrf_token%}
           <input type="text" name="comment" placeholder="Write your message here..."/>

        </form>

    </div>
    {%endif%}
   </div>

   <div>
       <h3>Participants</h3> 
       <hr>
       {%for user in participants%}
            <div>
                <p>@{{user.username}} </p>
            </div>
        
       {%endfor%}
    
   </div>
    
</div>
<script>
    function showReplyForm(messageId) {
        var form = document.getElementById('reply-form-' + messageId);
        form.style.display = (form.style.display === 'none') ? 'block' : 'none';
    }
</script>
{%endblock%}



